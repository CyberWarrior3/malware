# Malware Analysis - WannaMine

- [Malware Analysis - WannaMine](#malware-analysis---wannamine)
  - [Artifacts List](#artifacts-list)
    - [Domain Name / URL](#domain-name--url)
    - [Hashes](#hashes)
      - [cohernece.exe](#coherneceexe)
      - [java-log-9527.log](#java-log-9527log)
  - [Static Analysis](#static-analysis)
  - [Dynamic Analysis](#dynamic-analysis)
  - [External References](#external-references)

## Artifacts List

Additional PowerShell script and files that will be downloaded and executed by the WMI-embedded PowerShell payload from the C&C servers were not available during the investigation.

According to the overlapping of artifacts across WannaMine past operations, we decided to acquire and analyze artifacts from other operations to help us understand its functionality. Sources of those artifacts are already listed in the Reference section.

List of artifacts related to the incident, both direct and indirect, are listing below:

- Artifacts discovered on the **Invoke-Brexit** incident:
  - The WMI-embedded PowerShell payload
  - **cohernece.exe**: downloaded and executed by **RunDDOS**, contains DDoS and C&C communication functions.
  - **java-log-9527.log**: downloaded and executed by **RunDDOS** function, contains required shellcode that will be imported to **cohernece.exe**’s memory space.
- Related artifacts from WannaMine's past operations:
  - **ver.txt** contains a numerical value that specified WannaMine's version
  - **antivirus.ps1** contains encoded main modules, such as mimikatz, a monero miner, DDoS module, and additional shellcode
  - **antivirus.php** downloaded and executed by **regsvr32.exe** (see [MITRE ATT&CK Enterprise T1117](https://attack.mitre.org/techniques/T1117/))

- `841af8059e0e11807e5d97270c54eed7023e8a908868de34798c7d4e5733eac1` (`cohernece.exe`)
- `934d51d1ee68be3d98a4353e056ac5d1b76f6687d8adfcd982b97a2860740967` (`java-log-9527.log`)

### Domain Name / URL

- `*.conf1g[.]com`
- `185.128.43[.]54`

### Hashes

#### cohernece.exe

|  Hash  |                               Value                              |
|:------:|:----------------------------------------------------------------:|
|   MD5  |                 0dd58cecef246632d6e9d145c6f041c3                 |
|  SHA1  |             b99fdb6fb83359a8d9467f57e6118a4b28d03bed             |
| SHA256 | 841af8059e0e11807e5d97270c54eed7023e8a908868de34798c7d4e5733eac1 |

#### java-log-9527.log

|  Hash  |                               Value                              |
|:------:|:----------------------------------------------------------------:|
|   MD5  |                 05d4cebb8a5f0546dd9f15e5eb5e0a22                 |
|  SHA1  |             b8a8688d01eea26355a54469829768d38b71c57b             |
| SHA256 | 934d51d1ee68be3d98a4353e056ac5d1b76f6687d8adfcd982b97a2860740967 |

## Static Analysis

`cohernece.exe` and `java-log-9527.log` have been downloaded and executed by the `RunDDOS` function. On the infected system, `cohernece.exe` process is executed as a child of `powershell.exe` and `WmiPrvSE.exe`, and also create a new child process with the same name.

Analysis of `cohernece.exe`'s child process shows indicators relating to DDoS attack module.

## Dynamic Analysis

`cohernce.exe` can't be executed if `java-log-9527.log` is not in the same directory. Otherwise, `cohernece.exe` will open, read the file and update the `java-log-9527.log`'s content into its memory space.

## External References

See [WannaMine “Invoke-Brexit” Campaign Analysis](https://www.i-secure.co.th/2020/01/wannamine-invoke-brexit-campaign-analysis/)

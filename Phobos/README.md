# Malware Analysis - Phobos

- [Malware Analysis - Phobos](#malware-analysis---phobos)
  - [Indicator of Compromises](#indicator-of-compromises)
    - [Hashes](#hashes)
    - [Yara Rule](#yara-rule)
  - [Static Analysis](#static-analysis)
    - [Imports](#imports)
    - [Exports](#exports)
    - [Packing/Obfuscating](#packingobfuscating)
  - [External References](#external-references)

## Indicator of Compromises

### Hashes

|  Hash  |                               Value                              |
|:------:|:----------------------------------------------------------------:|
|   MD5  |                 d8d43026e808dca936645487fd1a64ab                 |
|  SHA1  |             b64ac0171eea944426860a5c3e4b51d848c0417d             |
| SHA256 | 6baf4eafb8c0e5aff3bd4406c09cf730f35e73fe6fe37e94ee21ba839929ec37 |

### Yara Rule

Generated by [Neo23x0/yarGen](https://github.com/Neo23x0/yarGen)

```yar
/*
   YARA Rule Set
   Author: pe3zx
   Date: 2019-04-09
   Identifier: yara
   Reference: Internal Research
*/

/* Rule Set ----------------------------------------------------------------- */

import "pe"

rule ransomware_phobos {
   meta:
      description = "ransomware - file sample.exe"
      author = "pe3zx"
      reference = "Internal Research"
      date = "2019-04-09"
      hash1 = "6baf4eafb8c0e5aff3bd4406c09cf730f35e73fe6fe37e94ee21ba839929ec37"
   strings:
      $s1 = "+ vdJ " fullword ascii
      $s2 = "HBvxLEs9=" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 400KB and
      ( pe.imphash() == "2f521903a14a73d4f4b209f8dce6e72f" or all of them )
}
```

## Static Analysis

### 

- kernel32.dll
    - LoadLibraryA
    - GetProcAddress
    - GetModuleHandleW
    - IsDebuggerPresent
    - UnhandledExceptionFilter
    - SetUnhandledExceptionFilter
    - EnterCriticalSection
    - LeaveCriticalSection
    - HeapSetInformation
    - ExitProcess
    - GetCommandLineA
    - TerminateProcess
    - GetCurrentProcess
    - DecodePointer
    - EncodePointer


### Exports

N/A

### Packing/Obfuscating

Custom packer by using [Tiny Encryption Algorithm (TEA)](https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm) with separate key file.

## External References

- [Michael Gillespie on Twitter: "Anyone seen anything dropping this executable? It is looking for "k.txt" along with it, expects it to be 0x10 bytes or it exits. Following a possible lead on #Phobos #Ransomware. May be a packer, has non-standard TEA decrypt routine. https://t.co/eoLVoyIL32â€¦ https://t.co/YqZ3B1e6vE"](https://twitter.com/demonslay335/status/1082699473950834688)
